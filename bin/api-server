#!/usr/bin/env node
require('shelljs/global');
var Promise = require("bluebird");
var fs = require('fs');
var console = require('logge');
#
# var jsonreader = require('../src/jsonreader');
#
#
console.debug = false;
console.set_log_request(false);


REQUEST_FOLDER_NAME = "/request"
RESPONSE_FOLDER_NAME = "/response"
GENERATE_MARKDOWN_FILE_NAME = "api.md"


function parse_request(){
	var request_dir = process.cwd() + REQUEST_FOLDER_NAME;
	var api_md_file = process.cwd() + '/' + GENERATE_MARKDOWN_FILE_NAME;
	var response_dir = process.cwd() + RESPONSE_FOLDER_NAME;
	
	rm("-rf",response_dir+'/*.res');
	log("request_dir = " + request_dir);
	
	if (test('-d', request_dir) == false) {
		mkdir('-p', request_dir);
		log('request folder is empty. you need put some.req in request folder');
		return;
	};
	
	if (test('-f', api_md_file) == false) {
		mkdir('-p', request_dir);
		log('当前目录没有api.md,不需要处理。');
		return;
	}else{
		rm("-rf",api_md_file);
		log('当前目录有api.md,已经清除了。');
	}
	
	parse_with_request_dir(request_dir);	
	console.log(filelist);
	
	// filelist = ["/Users/sang/workspace/github/api-test/play/request/get.req"];
	Promise.all(filelist).map(function(req_file) {
    console.log("单一文件处理");
		return request_processing_with_file(req_file);
	}).then(function(req_file) {
		console.log("所有文件都处理都已经完成");
		start_server();
	});
}

function start_server(){

}


function request_processing_with_file(req_file){
	console.log(req_file);
}

